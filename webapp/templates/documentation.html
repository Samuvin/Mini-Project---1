{% extends "base.html" %}

{% block title %}Documentation - Parkinson's Disease Detection{% endblock %}

{% block content %}
<div class="container">
    <div class="mb-4 fade-in-up">
        <h1 class="section-title"><i class="fas fa-book" style="color:var(--accent-start);"></i> API Documentation</h1>
        <p class="section-subtitle">Complete reference for the PD Detection API</p>
    </div>

    <!-- Overview -->
    <div class="row mb-4 fade-in-up fade-in-up-d1">
        <div class="col-12">
            <div class="card">
                <div class="card-body p-4">
                    <h3>API Overview</h3>
                    <p>
                        The Parkinson's Disease Detection API provides endpoints for making predictions
                        using the trained SE-ResNet deep learning model with attention-based multimodal fusion.
                        When the DL model is available, predictions include explainability data (attention weights,
                        Grad-CAM feature importance, SE channel weights). All endpoints return JSON responses.
                    </p>
                    <p class="mb-0"><strong>Base URL:</strong> <code>http://localhost:5000/api</code></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Endpoints -->
    <div class="mb-4 fade-in-up fade-in-up-d1">
        <h3 class="mb-3">API Endpoints</h3>

        <!-- Health Check -->
        <div class="card mb-3">
            <div class="card-header bg-success">
                <h5 class="mb-0" style="color:var(--text-primary);"><span class="badge-glass" style="margin-right:8px;">GET</span> /api/health</h5>
            </div>
            <div class="card-body p-4">
                <p><strong>Description:</strong> Health check endpoint to verify API status.</p>
                <h6>Response:</h6>
                <pre><code>{
  "status": "healthy",
  "active_backend": "deep_learning",
  "models_loaded": ["speech", "handwriting", "gait"],
  "dl_model": {
    "model_type": "SE-ResNet1D + Attention Fusion",
    "framework": "PyTorch",
    "available": true,
    "test_roc_auc": 0.95
  }
}</code></pre>
            </div>
        </div>

        <!-- Single Prediction -->
        <div class="card mb-3">
            <div class="card-header bg-primary">
                <h5 class="mb-0" style="color:var(--text-primary);"><span class="badge-glass" style="margin-right:8px;">POST</span> /api/predict</h5>
            </div>
            <div class="card-body p-4">
                <p><strong>Description:</strong> Make a prediction for a single sample. At least one modality must be provided. The DL model is used when available; otherwise falls back to sklearn.</p>

                <h6>Request:</h6>
                <pre><code>{
  "speech_features": [22 float values],
  "handwriting_features": [10 float values],
  "gait_features": [10 float values]
}</code></pre>
                <p><small style="color:var(--text-muted);">All three modalities are optional. Provide at least one. Missing modalities are zero-filled internally.</small></p>

                <h6>Response (Deep Learning):</h6>
                <pre><code>{
  "success": true,
  "prediction": 1,
  "prediction_label": "parkinsons",
  "confidence": 0.89,
  "probabilities": { "healthy": 0.11, "parkinsons": 0.89 },
  "model_type": "deep_learning",
  "ensemble_method": "SE-ResNet + Attention Fusion",
  "modalities_used": ["speech", "handwriting", "gait"],
  "attention_weights": {
    "speech": 0.45, "handwriting": 0.30, "gait": 0.25
  },
  "feature_importance": {
    "speech": [0.08, 0.12, ...],
    "handwriting": [0.15, 0.09, ...],
    "gait": [0.11, 0.07, ...]
  },
  "se_weights": {
    "speech": [0.6, 0.8, ...],
    "handwriting": [0.5, 0.9, ...],
    "gait": [0.7, 0.4, ...]
  },
  "feature_names": {
    "speech": ["MDVP:Fo(Hz)", "MDVP:Fhi(Hz)", ...],
    "handwriting": ["mean_pressure", ...],
    "gait": ["stride_interval", ...]
  }
}</code></pre>
            </div>
        </div>

        <!-- Batch Prediction -->
        <div class="card mb-3">
            <div class="card-header bg-info">
                <h5 class="mb-0" style="color:var(--text-primary);"><span class="badge-glass" style="margin-right:8px;">POST</span> /api/predict_batch</h5>
            </div>
            <div class="card-body p-4">
                <p><strong>Description:</strong> Batch predictions for multiple samples.</p>

                <h6>Request:</h6>
                <pre><code>{
  "features": [
    [0.5, 1.2, -0.3, ...],
    [0.8, 0.6, 0.1, ...],
    ...
  ]
}</code></pre>

                <h6>Response:</h6>
                <pre><code>{
  "success": true,
  "total_samples": 2,
  "results": [
    {
      "sample_id": 0,
      "prediction": 1,
      "prediction_label": "Parkinson's Disease",
      "confidence": 0.89,
      "probabilities": { "healthy": 0.11, "parkinsons": 0.89 }
    }
  ]
}</code></pre>
            </div>
        </div>

        <!-- Model Info -->
        <div class="card mb-3">
            <div class="card-header bg-warning">
                <h5 class="mb-0" style="color:var(--text-primary);"><span class="badge-glass" style="margin-right:8px;">GET</span> /api/model_info</h5>
            </div>
            <div class="card-body p-4">
                <p><strong>Description:</strong> Get information about the loaded models (DL and sklearn).</p>
                <h6>Response:</h6>
                <pre><code>{
  "success": true,
  "active_backend": "deep_learning",
  "dl_model": {
    "model_type": "SE-ResNet1D + Attention Fusion",
    "framework": "PyTorch",
    "available": true,
    "test_accuracy": 0.93,
    "test_f1": 0.95,
    "test_roc_auc": 0.97,
    "total_params": 195000,
    "epochs_trained": 85
  },
  "models": { ... },
  "loaded_modalities": ["speech", "handwriting", "gait"]
}</code></pre>
            </div>
        </div>
    </div>

    <!-- Usage Examples -->
    <div class="mb-4 fade-in-up fade-in-up-d2">
        <h3 class="mb-3">Usage Examples</h3>

        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fab fa-python" style="color:#ffc107;margin-right:6px;"></i> Python</h5>
            </div>
            <div class="card-body p-4">
                <pre><code>import requests

url = "http://localhost:5000/api/predict"
data = {
    "speech_features": [119.99, 157.30, 74.99, ...],      # 22 values
    "handwriting_features": [0.45, 0.18, 2.2, ...],       # 10 values
    "gait_features": [1.15, 0.08, 0.38, ...]              # 10 values
}

response = requests.post(url, json=data)
result = response.json()

print(f"Prediction: {result['prediction_label']}")
print(f"Confidence: {result['confidence']:.2%}")
print(f"Model: {result.get('model_type', 'sklearn')}")
if 'attention_weights' in result:
    print(f"Attention: {result['attention_weights']}")</code></pre>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-terminal" style="color:#75d9a0;margin-right:6px;"></i> cURL</h5>
            </div>
            <div class="card-body p-4">
                <pre><code>curl -X POST http://localhost:5000/api/predict \
  -H "Content-Type: application/json" \
  -d '{
    "speech_features": [119.99, 157.30, 74.99, 0.00784, ...],
    "handwriting_features": [0.45, 0.18, 2.2, ...],
    "gait_features": [1.15, 0.08, 0.38, ...]
  }'</code></pre>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fab fa-js-square" style="color:var(--accent-start);margin-right:6px;"></i> JavaScript</h5>
            </div>
            <div class="card-body p-4">
                <pre><code>fetch('http://localhost:5000/api/predict', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    speech_features: [119.99, 157.30, 74.99, ...],
    handwriting_features: [0.45, 0.18, 2.2, ...],
    gait_features: [1.15, 0.08, 0.38, ...]
  }),
})
.then(res => res.json())
.then(data => {
  console.log('Prediction:', data.prediction_label);
  console.log('Confidence:', data.confidence);
  console.log('Model:', data.model_type);
  if (data.attention_weights) {
    console.log('Attention:', data.attention_weights);
  }
});</code></pre>
            </div>
        </div>
    </div>

    <!-- Error Codes -->
    <div class="fade-in-up fade-in-up-d3">
        <h3 class="mb-3">Error Codes</h3>
        <div class="card">
            <div class="card-body p-4">
                <table class="table table-bordered mb-0">
                    <thead>
                        <tr>
                            <th style="width:100px;">Code</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>200</code></td>
                            <td>Success &mdash; Request completed successfully</td>
                        </tr>
                        <tr>
                            <td><code>400</code></td>
                            <td>Bad Request &mdash; Invalid input data</td>
                        </tr>
                        <tr>
                            <td><code>401</code></td>
                            <td>Unauthorized &mdash; Missing or invalid JWT token</td>
                        </tr>
                        <tr>
                            <td><code>413</code></td>
                            <td>Payload Too Large &mdash; File size exceeds limit</td>
                        </tr>
                        <tr>
                            <td><code>500</code></td>
                            <td>Server Error &mdash; Model not loaded or processing error</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
