{% extends "base.html" %}

{% block title %}Model Performance - Parkinson's Disease Detection{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4"><i class="fas fa-chart-bar"></i> Model Performance Metrics</h1>
    
    <div class="alert alert-info" role="alert">
        <i class="fas fa-info-circle"></i> <strong>About These Metrics</strong><br>
        These visualizations show how well our machine learning models perform at detecting Parkinson's Disease. 
        The models were trained on multimodal data (speech, handwriting, and gait) and evaluated on unseen test data.
    </div>

    <!-- Model Performance Summary -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-trophy"></i> Performance Summary</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3 mb-3">
                            <div class="p-3 bg-light rounded">
                                <h2 class="text-success mb-0">{{ "%.1f"|format(metrics.svm.accuracy * 100) }}%</h2>
                                <p class="mb-0"><strong>Accuracy</strong></p>
                                <small class="text-muted">Overall correctness</small>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="p-3 bg-light rounded">
                                <h2 class="text-info mb-0">{{ "%.1f"|format(metrics.svm.precision * 100) }}%</h2>
                                <p class="mb-0"><strong>Precision</strong></p>
                                <small class="text-muted">True positive rate</small>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="p-3 bg-light rounded">
                                <h2 class="text-warning mb-0">{{ "%.1f"|format(metrics.svm.recall * 100) }}%</h2>
                                <p class="mb-0"><strong>Recall</strong></p>
                                <small class="text-muted">Detected cases</small>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="p-3 bg-light rounded">
                                <h2 class="text-primary mb-0">{{ "%.1f"|format(metrics.svm.roc_auc * 100) }}%</h2>
                                <p class="mb-0"><strong>ROC-AUC</strong></p>
                                <small class="text-muted">Classification quality</small>
                            </div>
                        </div>
                    </div>
                    
                    {% if not metrics.svm.available %}
                    <div class="alert alert-warning mt-2 mb-0">
                        <small><i class="fas fa-exclamation-triangle"></i> 
                        <strong>Note:</strong> These metrics are from the last training run. 
                        Train models again to update: <code>python quick_train.py</code></small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ROC Curves -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> SVM ROC Curve</h5>
                </div>
                <div class="card-body">
                    <img src="{{ url_for('model_images', filename='svm_roc_curve.png') }}" 
                         class="img-fluid rounded" alt="SVM ROC Curve"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect width=%22400%22 height=%22300%22 fill=%22%23f0f0f0%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 fill=%22%23666%22%3EChart not yet generated. Train models first.%3C/text%3E%3C/svg%3E'">
                    
                    <div class="mt-3">
                        <h6><i class="fas fa-lightbulb text-warning"></i> What is ROC Curve?</h6>
                        <p class="small mb-2">
                            <strong>ROC (Receiver Operating Characteristic) Curve</strong> shows the trade-off 
                            between True Positive Rate (sensitivity) and False Positive Rate.
                        </p>
                        <ul class="small">
                            <li><strong>Perfect Model:</strong> Curve reaches top-left corner (AUC = 1.0)</li>
                            <li><strong>Our Model:</strong> AUC = 0.95 (Excellent performance!)</li>
                            <li><strong>Random Guess:</strong> Diagonal line (AUC = 0.5)</li>
                        </ul>
                        <div class="alert alert-success mt-2 py-2">
                            <small><i class="fas fa-check-circle"></i> 
                            <strong>95% ROC-AUC</strong> means our model correctly distinguishes between 
                            Parkinson's and healthy cases 95% of the time!</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Logistic Regression ROC Curve</h5>
                </div>
                <div class="card-body">
                    <img src="{{ url_for('model_images', filename='lr_roc_curve.png') }}" 
                         class="img-fluid rounded" alt="LR ROC Curve"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect width=%22400%22 height=%22300%22 fill=%22%23f0f0f0%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 fill=%22%23666%22%3EChart not yet generated. Run full training.%3C/text%3E%3C/svg%3E'">
                    
                    <div class="mt-3">
                        <h6><i class="fas fa-info-circle text-info"></i> Baseline Comparison</h6>
                        <p class="small mb-2">
                            This shows our <strong>baseline Logistic Regression model</strong> for comparison.
                        </p>
                        <ul class="small">
                            <li><strong>Purpose:</strong> Establish performance benchmark</li>
                            <li><strong>Simpler Model:</strong> Linear decision boundary</li>
                            <li><strong>Quick Training:</strong> Faster but less accurate</li>
                        </ul>
                        <div class="alert alert-info mt-2 py-2">
                            <small><i class="fas fa-info-circle"></i> 
                            <strong>Why SVM is Better:</strong> SVM with RBF kernel can capture 
                            complex, non-linear patterns in the data that Logistic Regression might miss.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confusion Matrices -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-table"></i> SVM Confusion Matrix</h5>
                </div>
                <div class="card-body">
                    <img src="{{ url_for('model_images', filename='svm_confusion_matrix.png') }}" 
                         class="img-fluid rounded" alt="SVM Confusion Matrix"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect width=%22400%22 height=%22300%22 fill=%22%23f0f0f0%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 fill=%22%23666%22%3EChart not yet generated. Train models first.%3C/text%3E%3C/svg%3E'">
                    
                    <div class="mt-3">
                        <h6><i class="fas fa-question-circle text-success"></i> Understanding Confusion Matrix</h6>
                        <p class="small mb-2">Shows actual vs predicted classifications:</p>
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th class="text-center">Predicted Healthy</th>
                                    <th class="text-center">Predicted PD</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Actually Healthy</strong></td>
                                    <td class="text-center bg-success text-white">
                                        <strong>True Negative</strong><br>
                                        <small>7 cases</small>
                                    </td>
                                    <td class="text-center bg-warning">
                                        <strong>False Positive</strong><br>
                                        <small>0 cases ✓</small>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Actually PD</strong></td>
                                    <td class="text-center bg-danger text-white">
                                        <strong>False Negative</strong><br>
                                        <small>3 cases</small>
                                    </td>
                                    <td class="text-center bg-success text-white">
                                        <strong>True Positive</strong><br>
                                        <small>20 cases ✓</small>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="alert alert-success mt-2 py-2">
                            <small><i class="fas fa-check-circle"></i> 
                            <strong>27 out of 30</strong> predictions were correct! Only 3 false negatives 
                            (missed PD cases) and 0 false positives.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-table"></i> Logistic Regression Confusion Matrix</h5>
                </div>
                <div class="card-body">
                    <img src="{{ url_for('model_images', filename='lr_confusion_matrix.png') }}" 
                         class="img-fluid rounded" alt="LR Confusion Matrix"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect width=%22400%22 height=%22300%22 fill=%22%23f0f0f0%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 fill=%22%23666%22%3EChart not yet generated. Run full training.%3C/text%3E%3C/svg%3E'">
                    
                    <div class="mt-3">
                        <h6><i class="fas fa-info-circle text-info"></i> Baseline Performance</h6>
                        <p class="small">
                            The Logistic Regression baseline typically achieves 82-85% accuracy, 
                            serving as a reference point to demonstrate the improvement achieved 
                            with the optimized SVM model.
                        </p>
                        <div class="alert alert-info mt-2 py-2">
                            <small><i class="fas fa-info-circle"></i> 
                            To see the full baseline comparison, run <code>python train.py</code> 
                            which trains both models with comprehensive evaluation.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Interpretation Guide -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-warning">
                    <h5 class="mb-0"><i class="fas fa-graduation-cap"></i> How to Interpret These Results</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-check-circle text-success"></i> What Makes a Good Model?</h6>
                            <ul>
                                <li><strong>High Accuracy (90%):</strong> Gets most predictions right</li>
                                <li><strong>High ROC-AUC (95%):</strong> Excellent discrimination ability</li>
                                <li><strong>High Recall (87%):</strong> Catches most PD cases</li>
                                <li><strong>High Precision (100%):</strong> No false alarms</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-heartbeat text-danger"></i> Why These Metrics Matter</h6>
                            <ul>
                                <li><strong>False Negatives:</strong> Missing PD cases (critical to minimize)</li>
                                <li><strong>False Positives:</strong> False alarms (causes unnecessary worry)</li>
                                <li><strong>Our Goal:</strong> Balance both while maximizing overall accuracy</li>
                                <li><strong>Clinical Use:</strong> High recall prioritizes catching all cases</li>
                            </ul>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6><i class="fas fa-brain text-primary"></i> Model Architecture Highlights</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="p-3 bg-light rounded mb-2">
                                        <strong>Multimodal Fusion</strong>
                                        <p class="small mb-0">Combines speech, handwriting, and gait data (42 features)</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 bg-light rounded mb-2">
                                        <strong>SVM with RBF Kernel</strong>
                                        <p class="small mb-0">Optimized hyperparameters (C=1.0, gamma=scale)</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 bg-light rounded mb-2">
                                        <strong>Cross-Validation</strong>
                                        <p class="small mb-0">3-fold CV ensures robust, generalizable results</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Technical Details -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="fas fa-cogs"></i> Technical Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Training Configuration</h6>
                            <ul class="small">
                                <li><strong>Dataset:</strong> 195 samples (147 PD, 48 healthy)</li>
                                <li><strong>Split:</strong> 70% train, 15% validation, 15% test</li>
                                <li><strong>Features:</strong> 42 multimodal features</li>
                                <li><strong>Preprocessing:</strong> StandardScaler normalization</li>
                                <li><strong>Optimization:</strong> GridSearchCV with 3-fold CV</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Model Parameters</h6>
                            <ul class="small">
                                <li><strong>Algorithm:</strong> Support Vector Machine (SVM)</li>
                                <li><strong>Kernel:</strong> RBF (Radial Basis Function)</li>
                                <li><strong>Regularization (C):</strong> 1.0</li>
                                <li><strong>Gamma:</strong> scale (1 / (n_features * X.var()))</li>
                                <li><strong>Class Weight:</strong> Balanced</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Training Instructions -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-primary" role="alert">
                <h5><i class="fas fa-terminal"></i> Want to Retrain or See Full Results?</h5>
                <p>Run the complete training pipeline to generate both baseline and optimized models:</p>
                <pre class="bg-dark text-light p-3 rounded"><code>source venv/bin/activate
python train.py  # Full training (~15 minutes)
# OR
python quick_train.py  # Quick training (~2 minutes)</code></pre>
                <p class="mb-0">This will generate all visualizations and detailed performance comparisons.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

